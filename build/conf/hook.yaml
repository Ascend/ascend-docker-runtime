component: hook
product: ToolBox
systemEnv:
  - workspace
  - processor
compile:
  name: hook
  version:
  input:
    files:
      exclude:
        - remove: [ "{{ systemEnv.workspace }}/ascend-docker-plugin/hook/build" ]
      include:
        - commands:
          - command: "mkdir {{ systemEnv.workspace }}/ascend-docker-plugin/hook/build"
          - command: "cd {{ systemEnv.workspace }}/ascend-docker-plugin/hook"
          - command: "export GOPATH={{ systemEnv.workspace }}/ascend-docker-plugin/opensource && env"
  process:
    language: go
    compilePath: "{{ systemEnv.workspace }}/ascend-docker-plugin/hook/"
    parameters: [
      [ "buildmode","pie" ],
      [ "ldflags",'-linkmode=external -buildid=IdNetCheck -extldflags "-Wl,-z,now" -w -s '],
      [ "trimpath","{{ systemEnv.workspace }}/ascend-docker-plugin/hook/main.go"],
      [ "o", "{{ systemEnv.workspace }}/ascend-docker-plugin/hook/build/ascend-docker-hook"]
      ]
  output:
    files:
      include:
        - copy:
            src: [ "{{ systemEnv.workspace }}/ascend-docker-plugin/hook/main" ]
            des: "{{ systemEnv.workspace }}/ascend-docker-plugin/hook/build/ascend-docker-hook"
            rename: true