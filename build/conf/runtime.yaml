component: runtime
product: ToolBox
systemEnv:
  - workspace
  - processor
compile:
  name: runtime
  version:
  input:
    files:
      exclude:
        - remove: [ "{{ systemEnv.workspace }}/ascend-docker-plugin/runtime/build" ]
      include:
        - commands:
            - command: "mkdir -p {{ systemEnv.workspace }}/ascend-docker-plugin/runtime/build"
            - command: "cd {{ systemEnv.workspace }}/ascend-docker-plugin/runtime"
            - command: "export GOPATH={{ systemEnv.workspace }}/ascend-docker-plugin/opensource && env"
  process:
    language: go
    compilePath: "{{ systemEnv.workspace }}/ascend-docker-plugin/runtime"
    parameters: [
      [ "buildmode", "pie" ],
      [ "ldflags", '-linkmode=external -buildid=IdNetCheck -extldflags "-Wl,-z,now" -w -s'],
      [ "o", "{{ systemEnv.workspace }}/ascend-docker-plugin/runtime/build/ascend-docker-runtime"],
      [ "trimpath", "{{ systemEnv.workspace }}/ascend-docker-plugin/runtime/main.go" ],
      ]
  output:
    files:
      include:
        - copy:
            src: [ "{{ systemEnv.workspace }}/ascend-docker-plugin/runtime/main" ]
            des: "{{ systemEnv.workspace }}/ascend-docker-plugin/runtime/build/ascend-docker-runtime"
            rename: true